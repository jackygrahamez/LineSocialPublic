jQuery.fn.motionCaptcha||function(t){function e(t){this.init(t)}t.fn.motionCaptcha=function(a,s){return this.each(function(){function i(t){var e,a;return t.touches&&t.touches.length>0?(e=t.touches[0].pageX-c.offset().left+u,a=t.touches[0].pageY-c.offset().top+v):t.offsetX?(e=t.offsetX-u,a=t.offsetY-v):(e=t.pageX-c.offset().left-u,a=t.pageY-c.offset().top-v),[e,a]}var n=t.extend({},t.fn.motionCaptcha.defaults,s);n.actionId="#"+n.actionId.replace(/\#/g,""),n.canvasId="#"+n.canvasId.replace(/\#/g,""),n.divId="#"+n.divId.replace(/\#/g,""),n.submitId=n.submitId?"#"+n.submitId.replace(/\#/g,""):!1;var r,o=(t("body"),t(this)),c=(t(n.divId),t(n.canvasId)),l=o.find('input[type="submit"]'),d=c.width(),h=c.height(),u=1*c.css("borderLeftWidth").replace("px",""),v=1*c.css("borderTopWidth").replace("px","");c[0].width=d,c[0].height=h;var f=c[0].getContext("2d");f.canvasWidth=d,f.canvasHeight=h,f.font=n.canvasFont,f.fillStyle=n.canvasTextColor,c.addClass(a);var m=!1,g=!1,b=[];r=new e(f);var x=function(e){e.preventDefault();var a=i(e),s=a[0],n=a[1];return m=!0,g=!0,t("body").addClass("mc-noselect"),f.clearRect(0,0,d,h),r.strokeStart(s,n),c.removeClass("mc-invalid mc-valid"),b=[[s,n]],!1},y=function(t){if(g)return g=0;if(m){t.preventDefault();var e=i(t),a=e[0],s=e[1];b.push([a,s]),r.stroke(a,s)}return!1},I=function(){if(m)if(m=!1,t("body").removeClass("mc-noselect"),b.length>=10){var e=o.find('input[name="_points"]'),a=[];for(p in b)a.push(b[p].join(","));a=a.join("|"),0==e.length?o.append(t("<input>").attr({name:"_points",type:"hidden",value:a})):e.val(a),l.removeAttr("disabled")}else l.attr("disabled","disabled");return!1};c.bind({mousedown:x,mousemove:y,mouseup:I}),c[0].addEventListener("touchstart",x,!1),c[0].addEventListener("touchmove",y,!1),c[0].addEventListener("touchend",I,!1),o.addClass(n.cssClass.replace(/\./,""))})},t.fn.motionCaptcha.defaults={actionId:"#mc-action",divId:"#mc",canvasId:"#mc-canvas",submitId:!1,cssClass:".mc-active",shapes:["triangle","x","rectangle","circle","check","caret","zigzag","arrow","leftbracket","rightbracket","v","delete","star","pigtail"],canvasFont:'15px "Lucida Grande"',canvasTextColor:"#111",errorMsg:"Please try again.",successMsg:"Captcha passed!",noCanvasMsg:"Your browser doesn't support <canvas> - try Chrome, FF4, Safari or IE9.",label:"<p>Please draw the shape in the box to submit the form:</p>",onSuccess:function(e){var a=this,s=a.submitId?e.find(a.submitId):e.find("input[type=submit]:disabled");e.attr("action",t(a.actionId).val()),s.prop("disabled",!1)},onError:function(){}},e.prototype={ctx:null,X:null,Y:null,painters:null,interval:null,init:function(t){function e(){var t;for(a.ctx.lineWidth=i,a.ctx.strokeStyle="rgba("+n[0]+", "+n[1]+", "+n[2]+", 0.06)",t=0;t<a.painters.length;t++)a.ctx.beginPath(),a.ctx.moveTo(a.painters[t].dx,a.painters[t].dy),a.painters[t].dx-=a.painters[t].ax=(a.painters[t].ax+(a.painters[t].dx-a.X)*a.painters[t].div)*a.painters[t].ease,a.painters[t].dy-=a.painters[t].ay=(a.painters[t].ay+(a.painters[t].dy-a.Y)*a.painters[t].div)*a.painters[t].ease,a.ctx.lineTo(a.painters[t].dx,a.painters[t].dy),a.ctx.stroke()}var a=this,s=navigator.userAgent.toLowerCase(),i=s.search("android")>-1||s.search("iphone")>-1?2:1,n=[0,0,0];this.ctx=t,this.ctx.globalCompositeOperation="source-over",this.X=this.ctx.canvasWidth/2,this.Y=this.ctx.canvasHeight/2,this.painters=[];for(var r=0;38>r;r++)this.painters.push({dx:this.ctx.canvasWidth/2,dy:this.ctx.canvasHeight/2,ax:0,ay:0,div:.1,ease:.18*Math.random()+.6});this.interval=setInterval(e,1e3/60)},destroy:function(){clearInterval(this.interval)},strokeStart:function(t,e){this.X=t,this.Y=e;for(var a=0;a<this.painters.length;a++)this.painters[a].dx=t,this.painters[a].dy=e;this.shouldDraw=!0},stroke:function(t,e){this.X=t,this.Y=e}}}(jQuery);