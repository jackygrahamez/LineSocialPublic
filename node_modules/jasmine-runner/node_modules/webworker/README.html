<p><code>node-webworkers</code> is an experimental implementation of the <a href="http://www.whatwg.org/specs/web-workers/current-work/">Web Workers
API</a> for
   <a href="http://nodejs.org">node.js</a>.
</p>

<h3>Example</h3>

<h4>Master source</h4>
<pre><code>var sys = require('sys');
var Worker = require('webworker').Worker;

var w = new Worker('foo.js');

w.onmessage = function(e) {
    sys.debug('Received mesage: ' + sys.inspect(e));
    w.terminate();
};

w.postMessage({ foo : 'bar' });
</code></pre>
<h4>Worker source</h4>
<pre><code>onmessage = function(e) {
    postMessage({ test : 'this is a test' });
};

onclose = function() {
    sys.debug('Worker shuttting down.');
};
</code></pre>
<h3>API</h3>
<p>Supported API methods are
</p>
<ul>
 <li>
     <code>postMessage(e)</code> in both workers and the parent; messages are in the
 parent if this is invoked before the child is fully initialized
 </li>

 <li>
     <code>onmessage(e)</code> in both workers and the parent
 </li>

 <li>
     <code>onerror(e)</code>in both workers and the parent
 </li>

 <li>
     <code>terminate()</code> in the parent
 </li>
</ul>
<p>In addition, some nonstandard APIs are provided
</p>
<ul>
 <li>
     <code>onclose()</code> in the worker (allows for graceful shutdown)
 </li>

 <li>
     The <code>postMessage()</code> method takes an additional optional file descriptor parameter, which
 will be sent with the message. This descriptor will be passed to
 <code>onmessage</code> handlers as an optional <code>fd</code> field. Handlers receiving
 messages posted without file descriptors will not see an <code>fd</code> field. Both
 the parent and child can send file descriptors using this mechanism.
 </li>

 <li>
     <code>Worker.onexit(code, signal)</code> in the master, which is invoked on the
 master <code>Worker</code> object when the worker process exits.
 </li>

 <li>
     The <code>Worker</code> constructor takes an additional optional object argument,
 <code>opts</code>, which is used as a dictionary of options with the following keys<ul>
 <li>
     <code>args</code> : A string or array of strings to pass to the <code>node</code> executable
         before the filename to invoke. This can be used to request that
         the worker start up in debug mode (e.g. <code>{ 'args' :
         '--debug-brk' }</code>).
 </li>
</ul>

 </li>
</ul>

<h3>Installation</h3>
<p>This package requires <a href="http://github.com/pgriess/node-msgpack">node-msgpack</a>.
</p>
<p>Installation is done using <code>make</code> on the <code>install</code> target. The <code>INSTALL_DIR</code>
   variable defines the directory to which JavaScript files will be installed and
   defaults to <code>/opt/local/share/node</code>.
</p>
<p>For example, to install to /foo/bar
</p>
<pre><code>% sudo make install INSTALL_DIR=/foo/bar
install -m 755 -d /foo/bar
install -m 444 lib/webworker.js lib/webworker-utils.js \
            lib/webworker-child.js /foo/bar
% find /foo/bar
/foo/bar
/foo/bar/webworker-child.js
/foo/bar/webworker-utils.js
/foo/bar/webworker.js
</code></pre>
